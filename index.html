<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Multistream</title>
    <style>
        body {
            margin: 0;
            width: 100vw;
            height: 100vh;
        }
        .streams {
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            justify-content: space-evenly;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        img {
            object-fit: contain;
            width: 100%;
            height: 100%;
        }
    </style>
    <script>
        function stream_template(name, w, h) {
            const width = (1 / Math.max(w, 1)) * 100;
            const height = (1 / Math.max(h, 1)) * 100;
            return `<div class="stream" style="width:${width}%;height:${height}%;"><iframe src="https://player.twitch.tv/?channel=${name}&muted=true&parent=scornexon.github.io/multitwitch/" width="100%" height="100%" allowfullscreen></iframe></div>`;
        }

        window.onload = function() {
            const elStreams = document.querySelector('.streams');
            const urlSearchParams = new URLSearchParams(window.location.search);
            const streams = urlSearchParams.get('streams') != undefined ? urlSearchParams.get('streams').split(',') : [];
            const vertical = urlSearchParams.get('vertical') != undefined ? 1 : 0;
            if (vertical) {
                elStreams.style.flexDirection = 'column';
            }

            let width = 1;
            let height = 1;
            let next = vertical;
            while (width * height < streams.length) {
                if (next == 0) {
                    width++;
                    next = 1;
                } else {
                    height++;
                    next = 0;
                }
            }
            let innerHTML = '';
            streams.forEach(stream => innerHTML += stream_template(stream, width, height));
            elStreams.innerHTML = innerHTML;
        }
    </script>
</head>
<body> 
    <div class="streams">
    </div>
</body>
</html>
